<mapper namespace="visit">

	<select id="visit_list" resultType="vo.VisitVo">
		select * from visit order by idx desc
	</select>
	
	<!-- trim : 중도삽입, prefix : trim 앞에 붙이는 문자열, prefixOverrides : trim 바로 다음에 이 속성에 등록한 문자가 나오면 그 문자를 제거함. -->
	<!-- 바로 아래 select는 매개변수로 name, content를 받아 둘 중 하나만 처리하거나 둘 다 처리하는 다이나믹 쿼리임 -->
	<select id="visit_list_condition" parameterType="java.util.Map" resultType="vo.VisitVo">
		select * from visit
		<trim prefix="where" prefixOverrides="or">
			<if test="name!=null">
				name like '%' || #{ name } || '%'
			</if>
			<if test="content!=null">
				or content like '%' || #{ content } || '%'
			</if>
		</trim>
		order by idx desc
	</select>
	
	<select id="visit_list_one" parameterType="int" resultType="vo.VisitVo">
		select * from visit where idx=#{ idx }
	</select>
	
	<insert id="visit_insert" parameterType="vo.VisitVo" >
		insert into visit values(seq_visit_idx.nextVal, #{name}, #{content}, #{pwd}, #{ip}, sysdate)
	</insert>
	
	<update id="visit_update" parameterType="vo.VisitVo">
		update visit set name=#{name}, content=#{content}, pwd=#{pwd}, ip=#{ip}, regdate=sysdate where idx=#{idx}
	</update>
	
	<delete id="visit_delete" parameterType="int">
		delete from visit where idx=#{idx}
	</delete>

</mapper>


// 또 다른 다이나믹 쿼리 예.

<!-- 	진행 순서 dept_list -> dept_map -> sawon_list_deptno_2 -> sawon_map -> gogek_list_sabun	-->
<mapper namespace="dept">

<resultMap type="vo.DeptVo" id="dept_map">
	<!-- 프로퍼티와 컬럼명이 같으면 생략가능.-->
	<result property="deptno" column="deptno"/>
	<result property="dname" column="dname"/>
	<result property="loc" column="loc"/>
	
	<collection property="sa_list" column="{deptno=deptno}" select="sawon_list_deptno_2"/>

</resultMap>

<resultMap type="vo.SawonVo" id="sawon_map">
	<collection property="gogek_list" column="{sabun=sabun}" select="gogek_list_sabun"></collection>
</resultMap>

	<select id="gogek_list_sabun" resultType="vo.GogekVo">
		select * from gogek where godam=#{sabun} 
	</select>

	<select id="sawon_list_deptno_2"  resultMap="sawon_map">
		select * from sawon where deptno=#{ deptno }
	</select>

	<!-- 전체 조회 -->
	<select id="dept_list" resultMap="dept_map">
		select * from dept
	</select>

</mapper>

